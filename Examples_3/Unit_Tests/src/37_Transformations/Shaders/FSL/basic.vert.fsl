/*

*/

#include "resourcesCastle.h.fsl"

STRUCT(VSInput)
{
	DATA(float4, Position, POSITION);
	DATA(float3, Normal, NORMAL);
    DATA(float3, TexCoord, TEXCOORD);
};

STRUCT(VSOutput)
{
	DATA(float4, Position, SV_Position);
	DATA(float4, Color,    COLOR);
};

VSOutput VS_MAIN( VSInput In, SV_InstanceID(uint) InstanceID )
{
    INIT_MAIN;
    VSOutput Out;
    
    Out.Position = mul(Get(mvp), In.Position);

    float4 pos = float4(In.Position.xyz, 1.0f);

    float lightIntensity = 1.0f;
    float ambientCoeff = 0.4;

    float3 lightDir;

    if (Get(color).w == 0.0f) // Special case for Sun, so that it is lit from its top
        lightDir = float3(0.0f, 1.0f, 0.0f);
    else
        lightDir = normalize(Get(lightPosition) - pos.xyz);

    float3 baseColor = Get(color).xyz;
    float3 blendedColor = (Get(lightColor) * baseColor) * lightIntensity;
    float3 ambient = baseColor * ambientCoeff;

    Out.Color = float4( In.Normal, 1.0);

    RETURN(Out);
}
